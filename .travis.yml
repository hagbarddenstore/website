language: go
go:
  - 1.6

sudo: false

env:
  global:
    - secure: "YWj5Rea87tVLRT4VKNQCbPRIf6PTT4/oK7quGlIEsL58GWD3D8j5oUnco4WKa4qOhLJQOlk/s2FFjTmjECuFjPdYxIuAk7jHnwehoQqEfR56GIFtKjkbIOTEtb0GR9MqJb3ni88f4Wr5cdIs7WN6nhjWfpJgW2UIhiAgBqWERmA="
    - secure: "NmSEwj0yx6P04EUhZoO6EK2hlRI4NwRlgigYicGWhry0tNTXNlVPNh8KBgOXmfUGtrSD7QH8Sddyu3bbRtBhxuO3nR+HpqTJ0F0qRWYrbJcYba4S6AXpH7dTl0GwnTcXA5G6nsbNSjMkJSklYStwiDMJj2slsRg/v063pHb1pE8="
    - secure: "YgFCIZ+uHHbtGFZNz3ib/AedY8DQ/ca5olUvPZzrzRIFVoxCuy+fDfgQ7ZNWX+pbAzAFvB7ym8VWCa8/NuHxVpJbQj8/bRf7YVdeGkulsmvdoT2XyJf2EJrM8O4Hrn3Uf1tMjPDJ4i7ietmMDi8nE7ZiRC1yj1NdDUAtXD9GMOA="

before_install:
  - pip install --user awscli
  - export PATH=$PATH:$HOME/.local/bin

install:
  - go get -u -v github.com/kardianos/govendor
  - go get -u -v github.com/spf13/hugo
  - cd $GOPATH/src/github.com/spf13/hugo && govendor sync && go install

script:
  - cd $TRAVIS_BUILD_DIR && hugo

deploy:
  - provider: s3
    access_key_id:
      secure: "Nx+Wv3hRsxNs/5wemAXyq5W7clORERRWsq9tLCRpdNUVbU02JYOKbtYlBhaPyg0ICvTi1O69Hdzn5jgEKATwSJIiAAcRf+QiNoVE8wuZIzJjuhORRQ3fTEjid2MSotjRCo2hl89zryLRiOQYxs+jFkhqYWPQCfEFrWhJBnNQ//Y="
    secret_access_key: 
      secure: "C18EvUElEwF0RMGvIM2zZdcrit5EPVT/nrKGT/jNYKxn6NO8hsn+U3rc/kTFZcit5l3Sler1A0Vyk0f9gs3NPE5XyTA8x6v00twgASAWkatLZsOwCmcdJc9hCC99FQ6vreZDdRp6qi9LzBr34Cx5HbhsefOSn+jJf0Ec/HV6/rk="
    bucket:
      secure: "FYIWhHFE5RZ4Gtsc1F82YOOO5nJFd70t4ZYk8OL39yTWImu7Eo8+Ar96Pji6eX26jX0vzgHLIF3yyV/xdm4GwHHn1zZOz+XFVft+mASUeIlIqVWwyK1eC8dycWM2KcF2ysBBDebHZ4DlD1Xgp/WWbd9MaCWxOkUn3o5hDaaNUyY="
    region: eu-west-1
    local_dir: public
    skip_cleanup: true

after_deploy:
  - aws configure set preview.cloudfront true
  - aws cloudfront create-invalidation --distribution-id $CF_DISTRIBUTION_ID --paths /
